<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用rook在k8s集群部署ceph（yaml方式） | Elijah Blog</title>
    <meta name="description" content="专注于运维技术知识共享">
    <meta name="generator" content="VitePress v1.3.1">
    <link rel="preload stylesheet" href="/assets/style.BFKGPWCm.css" as="style">
    
    <script type="module" src="/assets/app.9hfBdlul.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.U6HXpukZ.js">
    <link rel="modulepreload" href="/assets/chunks/theme.DwbKYtUG.js">
    <link rel="modulepreload" href="/assets/rook-ceph.md.DZu121Y_.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-02aa45e7><!--[--><!--]--><!--[--><span tabindex="-1" data-v-22dc1176></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-22dc1176> Skip to content </a><!--]--><!----><header class="VPNav" data-v-02aa45e7 data-v-08088af9><div class="VPNavBar has-sidebar top" data-v-08088af9 data-v-bf18cc39><div class="wrapper" data-v-bf18cc39><div class="container" data-v-bf18cc39><div class="title" data-v-bf18cc39><div class="VPNavBarTitle has-sidebar" data-v-bf18cc39 data-v-4af299d3><a class="title" href="/" data-v-4af299d3><!--[--><!--]--><!----><span data-v-4af299d3>Elijah Blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-bf18cc39><div class="content-body" data-v-bf18cc39><!--[--><!--]--><div class="VPNavBarSearch search" data-v-bf18cc39><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-bf18cc39 data-v-5a389bf2><span id="main-nav-aria-label" class="visually-hidden" data-v-5a389bf2> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-5a389bf2 data-v-125de55a><!--[--><span data-v-125de55a>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs.html" tabindex="0" data-v-5a389bf2 data-v-125de55a><!--[--><span data-v-125de55a>文档</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-bf18cc39 data-v-f4381c31><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-f4381c31 data-v-a5dad3f8 data-v-837a189c><span class="check" data-v-837a189c><span class="icon" data-v-837a189c><!--[--><span class="vpi-sun sun" data-v-a5dad3f8></span><span class="vpi-moon moon" data-v-a5dad3f8></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-bf18cc39 data-v-84bfe90d data-v-ee026d42><!--[--><a class="VPSocialLink no-icon" href="https://github.com/sreok/docs" aria-label="github" target="_blank" rel="noopener" data-v-ee026d42 data-v-94a69745><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-bf18cc39 data-v-b39062ce data-v-6f769cae><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6f769cae><span class="vpi-more-horizontal icon" data-v-6f769cae></span></button><div class="menu" data-v-6f769cae><div class="VPMenu" data-v-6f769cae data-v-ac7801f7><!----><!--[--><!--[--><!----><div class="group" data-v-b39062ce><div class="item appearance" data-v-b39062ce><p class="label" data-v-b39062ce>Appearance</p><div class="appearance-action" data-v-b39062ce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-b39062ce data-v-a5dad3f8 data-v-837a189c><span class="check" data-v-837a189c><span class="icon" data-v-837a189c><!--[--><span class="vpi-sun sun" data-v-a5dad3f8></span><span class="vpi-moon moon" data-v-a5dad3f8></span><!--]--></span></span></button></div></div></div><div class="group" data-v-b39062ce><div class="item social-links" data-v-b39062ce><div class="VPSocialLinks social-links-list" data-v-b39062ce data-v-ee026d42><!--[--><a class="VPSocialLink no-icon" href="https://github.com/sreok/docs" aria-label="github" target="_blank" rel="noopener" data-v-ee026d42 data-v-94a69745><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-bf18cc39 data-v-63227861><span class="container" data-v-63227861><span class="top" data-v-63227861></span><span class="middle" data-v-63227861></span><span class="bottom" data-v-63227861></span></span></button></div></div></div></div><div class="divider" data-v-bf18cc39><div class="divider-line" data-v-bf18cc39></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-02aa45e7 data-v-ef70e8c8><div class="container" data-v-ef70e8c8><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-ef70e8c8><span class="vpi-align-left menu-icon" data-v-ef70e8c8></span><span class="menu-text" data-v-ef70e8c8>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-ef70e8c8 data-v-40735804><button data-v-40735804>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-02aa45e7 data-v-f17ec55f><div class="curtain" data-v-f17ec55f></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-f17ec55f><span class="visually-hidden" id="sidebar-aria-label" data-v-f17ec55f> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a9203bc9><section class="VPSidebarItem level-0 is-link" data-v-a9203bc9 data-v-6c04240e><div class="item" tabindex="0" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/kubernetes.html" data-v-6c04240e><!--[--><h2 class="text" data-v-6c04240e>云原生</h2><!--]--></a><!----></div><div class="items" data-v-6c04240e><!--[--><section class="VPSidebarItem level-1" data-v-6c04240e data-v-6c04240e><div class="item" role="button" tabindex="0" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><h3 class="text" data-v-6c04240e>Kubernetes</h3><!----></div><div class="items" data-v-6c04240e><!--[--><section class="VPSidebarItem level-2" data-v-6c04240e data-v-6c04240e><div class="item" role="button" tabindex="0" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><h4 class="text" data-v-6c04240e>部署</h4><!----></div><div class="items" data-v-6c04240e><!--[--><div class="VPSidebarItem level-3 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/deploy-kubernetes-ha-v1.30.2.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>Rocky 9.4 部署高可用集群</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2" data-v-6c04240e data-v-6c04240e><div class="item" role="button" tabindex="0" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><h4 class="text" data-v-6c04240e>负载均衡</h4><!----></div><div class="items" data-v-6c04240e><!--[--><div class="VPSidebarItem level-3 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/lb-kubevip-loadbalancer.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>使用kube-vip实现LoadBalancer(Layer2模式)</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2" data-v-6c04240e data-v-6c04240e><div class="item" role="button" tabindex="0" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><h4 class="text" data-v-6c04240e>高可用方案</h4><!----></div><div class="items" data-v-6c04240e><!--[--><div class="VPSidebarItem level-3 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/ha-keepalived-haproxy.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>使用Keepalived + Haproxy作为控制平面负载入口</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/ha-kube-vip.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>使用kube-vip作为控制平面负载入口</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><!--]--></div></section></div><div class="no-transition group" data-v-a9203bc9><section class="VPSidebarItem level-0" data-v-a9203bc9 data-v-6c04240e><div class="item" role="button" tabindex="0" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><h2 class="text" data-v-6c04240e>云计算</h2><!----></div><div class="items" data-v-6c04240e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/openstack-t.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>OpenStack T版部署(kolla方式)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/openstack-z.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>OpenStack Z版部署(kolla方式)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a9203bc9><section class="VPSidebarItem level-0 has-active" data-v-a9203bc9 data-v-6c04240e><div class="item" role="button" tabindex="0" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><h2 class="text" data-v-6c04240e>存储</h2><!----></div><div class="items" data-v-6c04240e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/rook-ceph.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>使用rook在k8s集群部署ceph(manifest方式)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a9203bc9><section class="VPSidebarItem level-0" data-v-a9203bc9 data-v-6c04240e><div class="item" role="button" tabindex="0" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><h2 class="text" data-v-6c04240e>网络</h2><!----></div><div class="items" data-v-6c04240e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/docs.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>使用rook在k8s集群部署ceph(manifest方式)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a9203bc9><section class="VPSidebarItem level-0" data-v-a9203bc9 data-v-6c04240e><div class="item" role="button" tabindex="0" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><h2 class="text" data-v-6c04240e>故障排除</h2><!----></div><div class="items" data-v-6c04240e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/bug-linux-disk.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>使用rook在k8s集群部署ceph(manifest方式)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/bug-postgres.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>Postgre启动失败: Bus error (core dumped)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6c04240e data-v-6c04240e><div class="item" data-v-6c04240e><div class="indicator" data-v-6c04240e></div><a class="VPLink link link" href="/bug-kubevip-metallb.html" data-v-6c04240e><!--[--><p class="text" data-v-6c04240e>kube-vip 与 MetalLB LoadBalancer Layer2 ARP冲突</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-02aa45e7 data-v-4b1e5151><div class="VPDoc has-sidebar has-aside" data-v-4b1e5151 data-v-feb27704><!--[--><!--]--><div class="container" data-v-feb27704><div class="aside" data-v-feb27704><div class="aside-curtain" data-v-feb27704></div><div class="aside-container" data-v-feb27704><div class="aside-content" data-v-feb27704><div class="VPDocAside" data-v-feb27704 data-v-0555e5a3><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-0555e5a3 data-v-3a01278e><div class="content" data-v-3a01278e><div class="outline-marker" data-v-3a01278e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-3a01278e>On this page</div><ul class="VPDocOutlineItem root" data-v-3a01278e data-v-65ce6fd8><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-0555e5a3></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-feb27704><div class="content-container" data-v-feb27704><!--[--><!--]--><main class="main" data-v-feb27704><div style="position:relative;" class="vp-doc _rook-ceph" data-v-feb27704><div><h1 id="使用rook在k8s集群部署ceph-yaml方式" tabindex="-1">使用rook在k8s集群部署ceph（yaml方式） <a class="header-anchor" href="#使用rook在k8s集群部署ceph-yaml方式" aria-label="Permalink to &quot;使用rook在k8s集群部署ceph（yaml方式）&quot;">​</a></h1><h2 id="前提条件" tabindex="-1">前提条件 <a class="header-anchor" href="#前提条件" aria-label="Permalink to &quot;前提条件&quot;">​</a></h2><ul><li>k8s 集群</li><li>节点挂载空盘用于ceph osd</li></ul><p>下载源文件，本文档是1.14.1<a href="https://github.com/rook/rook/archive/refs/tags/v1.14.1.tar.gz" target="_blank" rel="noreferrer">Source code (tar.gz) (github.com)</a></p><p><code>解压进入deploy/examples目录，以下操作如果没有说明，都是在examples目录下操作</code></p><h2 id="部署" tabindex="-1">部署 <a class="header-anchor" href="#部署" aria-label="Permalink to &quot;部署&quot;">​</a></h2><h3 id="部署operator" tabindex="-1">部署operator <a class="header-anchor" href="#部署operator" aria-label="Permalink to &quot;部署operator&quot;">​</a></h3><h5 id="打开自动发现" tabindex="-1">打开自动发现 <a class="header-anchor" href="#打开自动发现" aria-label="Permalink to &quot;打开自动发现&quot;">​</a></h5><p>修改operator.yaml 中的ROOK_ENABLE_DISCOVERY_DAEMON为true</p><p><img src="data:image/png;base64,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" alt="image-20240418150801705"></p><h5 id="修改镜像地址" tabindex="-1">修改镜像地址 <a class="header-anchor" href="#修改镜像地址" aria-label="Permalink to &quot;修改镜像地址&quot;">​</a></h5><p>国内访问不到google地址，使用<code>修改为阿里云地址</code>，我这里使用私有仓库，只要保证可以拉取到即可。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ROOK_CSI_CEPH_IMAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;registry.aliyuncs.com/google_containers/cephcsi:v3.10.2&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ROOK_CSI_REGISTRAR_IMAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;registry.aliyuncs.com/google_containers/csi-node-driver-registrar:v2.9.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ROOK_CSI_RESIZER_IMAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;registry.aliyuncs.com/google_containers/csi-resizer:v1.9.2&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ROOK_CSI_PROVISIONER_IMAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;registry.aliyuncs.com/google_containers/csi-provisioner:v3.6.3&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ROOK_CSI_SNAPSHOTTER_IMAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;registry.aliyuncs.com/google_containers/csi-snapshotter:v6.3.2&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ROOK_CSI_ATTACHER_IMAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;registry.aliyuncs.com/google_containers/csi-attacher:v4.4.2&quot;</span></span></code></pre></div><p><img src="/assets/image-20240418150706666.Bv0B3AuK.png" alt="image-20240418150706666"></p><h5 id="开始部署" tabindex="-1">开始部署 <a class="header-anchor" href="#开始部署" aria-label="Permalink to &quot;开始部署&quot;">​</a></h5><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> crds.yaml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> common.yaml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> operator.yaml</span></span></code></pre></div><p>等待所有pod运行</p><p><img src="/assets/image-20240418151845219.Cj9s0iw-.png" alt="image-20240418151845219"></p><p>如果这是你第一次安装，不需要初始化，否则需要将磁盘清空。<code>谨慎操作!!!</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DISK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Zap the disk to a fresh, usable state (zap-all is important, b/c MBR has to be clean)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sgdisk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --zap-all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $DISK</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Wipe a large portion of the beginning of the disk to remove more LVM metadata that may be present</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> if=/dev/zero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of=&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$DISK</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bs=1M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> count=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> oflag=direct,dsync</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SSDs may be better cleaned with blkdiscard instead of dd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blkdiscard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $DISK</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Inform the OS of partition table changes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">partprobe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $DISK</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This command hangs on some systems: with caution, &#39;dmsetup remove_all --force&#39; can be used</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/mapper/ceph-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> xargs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dmsetup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> %</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /dev/null</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ceph-volume setup can leave ceph-&lt;UUID&gt; directories in /dev and /dev/mapper (unnecessary clutter)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/ceph-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/mapper/ceph--</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rook/</span></span></code></pre></div><p>集群中每个节点都运行以上脚本初始化磁盘</p><p><img src="/assets/image-20240418152246842.CJJwLFzs.png" alt="image-20240418152246842"></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./cleanup.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/sdx</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 将sdb盘清空，并删除ceph遗留文件</span></span></code></pre></div><p><img src="/assets/image-20240418152414952.BNlH2e9A.png" alt="image-20240418152414952"></p><h3 id="部署集群" tabindex="-1">部署集群 <a class="header-anchor" href="#部署集群" aria-label="Permalink to &quot;部署集群&quot;">​</a></h3><p>修改cluster.yaml文件中的storage，如果想使用集群中所有的节点上的所有存储，使用默认配置即可</p><p><img src="/assets/image-20240418153102763.xx3ivj0c.png" alt="image-20240418153102763"></p><p>同时支持定义指定节点指定磁盘。如下，指定k8s-master01、2、3中的sd开头的磁盘</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">storage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cluster level storage configuration and selection</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    useAllNodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    useAllDevices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    deviceFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;k8s-master01&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        deviceFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^sd.&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;k8s-master02&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        deviceFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^sd.&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;k8s-master03&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        deviceFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^sd.&quot;</span></span></code></pre></div><p>如果指定单个磁盘</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">storage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cluster level storage configuration and selection</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    useAllNodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    useAllDevices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;k8s-master01&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        devices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sdb&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;k8s-master02&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        devices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sdb&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;k8s-master03&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        devices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sdb&quot;</span></span></code></pre></div><p>开始部署</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl apply -f cluster.yaml</span></span></code></pre></div><p><img src="/assets/image-20240418170336593.Cu1kUBPt.png" alt="image-20240418170336593"></p><p>检查pod状态</p><p><img src="/assets/image-20240418170357293.CbxeV6_B.png" alt="image-20240418170357293"></p><h3 id="部署工具" tabindex="-1">部署工具 <a class="header-anchor" href="#部署工具" aria-label="Permalink to &quot;部署工具&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> toolbox.yaml</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rook-ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rook-ceph-tools-66b77b8df5-b7r22</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ceph -s # 检查状态</span></span></code></pre></div><p><img src="/assets/image-20240418170432243.C3NSjKZf.png" alt="image-20240418170432243"></p><h3 id="部署storageclass并测试" tabindex="-1">部署StorageClass并测试 <a class="header-anchor" href="#部署storageclass并测试" aria-label="Permalink to &quot;部署StorageClass并测试&quot;">​</a></h3><h4 id="使用cephfs" tabindex="-1">使用cephfs <a class="header-anchor" href="#使用cephfs" aria-label="Permalink to &quot;使用cephfs&quot;">​</a></h4><p>CephFS 共享文件系统（Shared Filesystem）适用于多个Pod之间共享读写（RWX）的存储</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl apply -f filesystem.yaml</span></span></code></pre></div><p>等待文件系统状态ready</p><p><img src="data:image/png;base64,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" alt="image-20240418170726545"></p><p>部署storageclass</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>cd csi/cephfs</span></span>
<span class="line"><span>kubectl apply -f storageclass.yaml</span></span></code></pre></div><p>检查状态</p><p><img src="/assets/image-20240418170846036.D3T8Mpua.png" alt="image-20240418170846036"></p><h5 id="测试cephfs申请动态pvc" tabindex="-1">测试cephfs申请动态pvc <a class="header-anchor" href="#测试cephfs申请动态pvc" aria-label="Permalink to &quot;测试cephfs申请动态pvc&quot;">​</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl apply -f pvc.yaml</span></span></code></pre></div><p>绑定成功</p><p><img src="/assets/image-20240418171026652.Cr7fYIdx.png" alt="image-20240418171026652"></p><h4 id="使用rbd存储" tabindex="-1">使用rbd存储 <a class="header-anchor" href="#使用rbd存储" aria-label="Permalink to &quot;使用rbd存储&quot;">​</a></h4><p>块存储（Block）适用于为单个 Pod 提供读写一致性（RWO）的存储</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>cd csi/rbd</span></span>
<span class="line"><span>kubectl apply -f storageclass.yaml</span></span></code></pre></div><p><img src="data:image/png;base64,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" alt="image-20240418171241591"></p><h5 id="测试rbd申请动态pvc" tabindex="-1">测试rbd申请动态pvc <a class="header-anchor" href="#测试rbd申请动态pvc" aria-label="Permalink to &quot;测试rbd申请动态pvc&quot;">​</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl apply -f pvc.yaml</span></span></code></pre></div><p><img src="/assets/image-20240418171208563.Kzh3oZBp.png" alt="image-20240418171208563"></p><h4 id="使用对象存储" tabindex="-1">使用对象存储 <a class="header-anchor" href="#使用对象存储" aria-label="Permalink to &quot;使用对象存储&quot;">​</a></h4><p>对象存储（Object）提供了一个可通过内部或外部的Kubernetes集群的S3端点访问的存储</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl apply -f object.yaml</span></span></code></pre></div><p>等待状态ready</p><p><img src="data:image/png;base64,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" alt="image-20240419151532607"></p><p>部署storageclass</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl create -f storageclass-bucket-delete.yaml</span></span></code></pre></div><p><img src="/assets/image-20240419152006351.KzTOLK1g.png" alt="image-20240419152006351"></p><h5 id="测试使用对象存储" tabindex="-1">测试使用对象存储 <a class="header-anchor" href="#测试使用对象存储" aria-label="Permalink to &quot;测试使用对象存储&quot;">​</a></h5><p>创建OBC对象存储桶</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span> kubectl apply -f object-bucket-claim-delete.yaml</span></span></code></pre></div><p><img src="data:image/png;base64,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" alt="image-20240419151817881"></p><h5 id="安装测试工具s5cmd" tabindex="-1">安装测试工具s5cmd <a class="header-anchor" href="#安装测试工具s5cmd" aria-label="Permalink to &quot;安装测试工具s5cmd&quot;">​</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>wget https://github.com/peak/s5cmd/releases/download/v2.2.2/s5cmd_2.2.2_Linux-64bit.tar.gz</span></span>
<span class="line"><span>tar -xvf s5cmd_2.2.2_Linux-64bit.tar.gz</span></span>
<span class="line"><span>mv s5cmd /usr/local/bin/</span></span></code></pre></div><h6 id="设置凭证" tabindex="-1">设置凭证 <a class="header-anchor" href="#设置凭证" aria-label="Permalink to &quot;设置凭证&quot;">​</a></h6><p>可以使用一下命令生成，或者手动获取OBC同名secret，base64解码获取并写到配置文件</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>export AWS_ACCESS_KEY_ID=$(kubectl -n default get secret ceph-delete-bucket -o jsonpath=&#39;{.data.AWS_ACCESS_KEY_ID}&#39; | base64 --decode)</span></span>
<span class="line"><span>export AWS_SECRET_ACCESS_KEY=$(kubectl -n default get secret ceph-delete-bucket -o jsonpath=&#39;{.data.AWS_SECRET_ACCESS_KEY}&#39; | base64 --decode)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mkdir ~/.aws</span></span>
<span class="line"><span>cat &gt; ~/.aws/credentials &lt;&lt; EOF</span></span>
<span class="line"><span>[default]</span></span>
<span class="line"><span>aws_access_key_id = ${AWS_ACCESS_KEY_ID}</span></span>
<span class="line"><span>aws_secret_access_key = ${AWS_SECRET_ACCESS_KEY}</span></span>
<span class="line"><span>EOF</span></span></code></pre></div><h5 id="测试获取桶列表" tabindex="-1">测试获取桶列表 <a class="header-anchor" href="#测试获取桶列表" aria-label="Permalink to &quot;测试获取桶列表&quot;">​</a></h5><p>列出当前凭据可以访问的所有桶</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl get svc -n rook-ceph</span></span></code></pre></div><p><img src="/assets/image-20240419153621680.BNqvulNa.png" alt="image-20240419153621680"></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>s5cmd --endpoint-url  http://10.107.248.38 ls</span></span></code></pre></div><p><img src="/assets/image-20240419153209231.CWDh2G4U.png" alt="image-20240419153209231"></p><p>桶名称与configmap对应即可。</p><h2 id="卸载" tabindex="-1">卸载 <a class="header-anchor" href="#卸载" aria-label="Permalink to &quot;卸载&quot;">​</a></h2><p>清空ceph的pvc资源（根据环境删除）</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl delete pvc rbd-pvc cephfs-pvc</span></span></code></pre></div><p>删除storageclass</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl delete sc rook-cephfs rook-ceph-block</span></span>
<span class="line"><span>kubectl delete -f filesystem.yaml # 如果没有部署cephfs就不需要删除</span></span></code></pre></div><p>卸载集群</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl delete -f cluster.yaml</span></span>
<span class="line"><span>或者</span></span>
<span class="line"><span>kubectl delete cephcluster -n rook-ceph rook-ceph</span></span></code></pre></div><p>卸载工具</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl delete -f toolbox.yaml</span></span></code></pre></div><p>卸载operator</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl apply -f crds.yaml -f common.yaml -f operator.yaml</span></span></code></pre></div><p>清理磁盘</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>./cleanup.sh /dev/sdx</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-feb27704 data-v-a8c64ef9><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-a8c64ef9><span class="visually-hidden" id="doc-footer-aria-label" data-v-a8c64ef9>Pager</span><div class="pager" data-v-a8c64ef9><a class="VPLink link pager-link prev" href="/openstack-z.html" data-v-a8c64ef9><!--[--><span class="desc" data-v-a8c64ef9>Previous page</span><span class="title" data-v-a8c64ef9>OpenStack Z版部署(kolla方式)</span><!--]--></a></div><div class="pager" data-v-a8c64ef9><a class="VPLink link pager-link next" href="/docs.html" data-v-a8c64ef9><!--[--><span class="desc" data-v-a8c64ef9>Next page</span><span class="title" data-v-a8c64ef9>使用rook在k8s集群部署ceph(manifest方式)</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"bug-kubevip-metallb.md\":\"DoU_cart\",\"bug-linux-disk.md\":\"DbNDzAH4\",\"bug-postgres.md\":\"BSD-7LdE\",\"ha-keepalived-haproxy.md\":\"BGEDEzcr\",\"ha-kube-vip.md\":\"D-mC-cXZ\",\"index.md\":\"BUME0QPS\",\"lb-kubevip-loadbalancer.md\":\"DmVpscD3\",\"rook-ceph.md\":\"DZu121Y_\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Elijah Blog\",\"description\":\"专注于运维技术知识共享\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"文档\",\"link\":\"/docs\"}],\"sidebar\":[{\"text\":\"云原生\",\"items\":[{\"text\":\"Kubernetes\",\"items\":[{\"text\":\"部署\",\"items\":[{\"text\":\"Rocky 9.4 部署高可用集群\",\"link\":\"/deploy-kubernetes-ha-v1.30.2\"}]},{\"text\":\"负载均衡\",\"items\":[{\"text\":\"使用kube-vip实现LoadBalancer(Layer2模式)\",\"link\":\"/lb-kubevip-loadbalancer\"}]},{\"text\":\"高可用方案\",\"items\":[{\"text\":\"使用Keepalived + Haproxy作为控制平面负载入口\",\"link\":\"/ha-keepalived-haproxy\"},{\"text\":\"使用kube-vip作为控制平面负载入口\",\"link\":\"/ha-kube-vip\"}]}]}],\"link\":\"/kubernetes\"},{\"text\":\"云计算\",\"items\":[{\"text\":\"OpenStack T版部署(kolla方式)\",\"link\":\"/openstack-t\"},{\"text\":\"OpenStack Z版部署(kolla方式)\",\"link\":\"/openstack-z\"}]},{\"text\":\"存储\",\"items\":[{\"text\":\"使用rook在k8s集群部署ceph(manifest方式)\",\"link\":\"/rook-ceph\"}]},{\"text\":\"网络\",\"items\":[{\"text\":\"使用rook在k8s集群部署ceph(manifest方式)\",\"link\":\"/docs\"}]},{\"text\":\"故障排除\",\"items\":[{\"text\":\"使用rook在k8s集群部署ceph(manifest方式)\",\"link\":\"/bug-linux-disk\"},{\"text\":\"Postgre启动失败: Bus error (core dumped)\",\"link\":\"/bug-postgres\"},{\"text\":\"kube-vip 与 MetalLB LoadBalancer Layer2 ARP冲突\",\"link\":\"/bug-kubevip-metallb\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/sreok/docs\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>